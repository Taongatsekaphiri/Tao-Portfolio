<%- include('partials/header', {
  page: 'home',
  pageStyles: `<link rel="stylesheet" href="/css/style.css">`
}) %>

<% const safeHome = typeof home !== 'undefined' && home ? home : {}; %>

<section id="home" class="hero" data-bg-color="<%= safeHome.bg_color || '#E6FAF6' %>">
  <div class="hero-left" data-reveal="left">
    <h1><%= safeHome.main_heading || '' %></h1>
    <p id="typed-text" data-typed-lines="<%= JSON.stringify(Array.isArray(safeHome.typed_lines) ? safeHome.typed_lines : []) %>"></p>

    <% const tagsArray = safeHome.tags ? safeHome.tags.split(',') : []; %>
    <% if (tagsArray.length > 0) { %>
      <div class="tags">
        <% for (var i = 0; i < tagsArray.length; i++) { %>
          <span><%= tagsArray[i].trim() %></span>
        <% } %>
      </div>
    <% } %>

    <% if (safeHome.button_text) { %>
      <a href="<%= safeHome.button_link || '#' %>" class="cta-button"><%= safeHome.button_text %></a>
    <% } %>

    <div class="secret-admin" onclick="openAdminPopup()">•</div>
  </div>

  <div class="hero-right" data-reveal="right">
    <div class="hero-illustration">
      <% if (safeHome.love_image) { %>
        <img src="<%= safeHome.love_image %>" class="love-top-right" alt="love">
      <% } %>

      <% if (safeHome.main_image) { %>
        <img src="<%= safeHome.main_image %>" class="main-illustration coding-bg" alt="main">
      <% } %>

      <% if (safeHome.plant_image) { %>
        <img src="<%= safeHome.plant_image %>" class="plant-bottom" alt="plant">
      <% } %>
    </div>
  </div>
</section>

<div id="adminPopup" class="popup-overlay">
  <div class="popup-box">
    <span class="close-btn" onclick="closeAdminPopup()">&times;</span>
    <h2>Admin Access</h2>
    <input type="password" id="adminPassword" placeholder="Enter password">
    <button id="adminLoginBtn">Login</button>
    <p id="errorMsg" class="error"></p>
  </div>
</div>

<footer>
  © Taonga Tseka Phiri <%= new Date().getFullYear() %> | Crafted with Precision
</footer>

<script>
  // Home typed text
  (function(){
    const el = document.getElementById('typed-text');
    if(!el) return;
    let lines = [];
    try { lines = JSON.parse(el.dataset.typedLines || '[]'); } catch(e) { lines = []; }
    let index = 0;
    function showLine(){
      if (!el || lines.length === 0) return;
      el.textContent = lines[index];
      index = (index + 1) % lines.length;
      setTimeout(showLine, 3000);
    }
    if (lines.length > 0) showLine();
  })();

  // Apply dynamic hero background color (avoids template-lint CSS parse issues)
  (function(){
    const hero = document.getElementById('home');
    if (!hero) return;
    const bg = hero.dataset.bgColor;
    if (bg) hero.style.backgroundColor = bg;
  })();
</script>

<script src="/js/admin-popup.js"></script>